---
import Layout from './Layout.astro';
import { Heading1, BreadcrumbNav, BreadcrumbNavLink, BreadcrumbNavSeparator } from '@utrecht/component-library-react';
import { base } from 'astro:config/client';

interface Props {
  page: {
    id: string;
    data: {
      title: string;
      description?: string;
    };
  };
}

const { page } = Astro.props;

function generateBreadcrumbs(pageId: string) {
  const slug = pageId.replace(/\.mdx?$/, '');
  const parts = slug.split('/');
  const breadcrumbs: Array<{ label: string; href: string }> = [];

  breadcrumbs.push({ label: 'Home', href: `${base}/` });

  let currentPath = '';
  for (let i = 0; i < parts.length - 1; i++) {
    currentPath += (currentPath ? '/' : '') + parts[i];
    const label = parts[i]
      .split('-')
      .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
      .join(' ');
    breadcrumbs.push({ label, href: `${base}/${currentPath}` });
  }

  return breadcrumbs;
}

const breadcrumbs = generateBreadcrumbs(page.id);
---

<Layout>
  <article class="content-page">
    {breadcrumbs.length > 1 && (
      <BreadcrumbNav>
        {breadcrumbs.map((crumb, index) => (
          <>
            {index > 0 && <BreadcrumbNavSeparator><utrecht-icon-chevron-right /></BreadcrumbNavSeparator>}
            <BreadcrumbNavLink
              href={crumb.href}
              index={index}
              current={index === breadcrumbs.length - 1}
            >
              {crumb.label}
            </BreadcrumbNavLink>
          </>
        ))}
      </BreadcrumbNav>
    )}

    <header class="content-page__header">
      <Heading1>{page.data.title}</Heading1>
    </header>

    <div class="content-page__body">
      <slot />
    </div>
  </article>
</Layout>

<style>
  .content-page {
    padding-block-start: 2rem;
  }

  .content-page__header {
    margin-block-end: 2rem;
  }
</style>
